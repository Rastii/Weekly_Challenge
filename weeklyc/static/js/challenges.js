// Generated by CoffeeScript 1.3.3
(function() {
  var __indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

  $(document).ready(function() {
    return $.ajax('/api/challenges', {
      type: 'GET',
      dataType: 'json',
      error: function(jqXHR, textStatus, errorThrown) {
        return console.error(jqXHR, textStatus, errorThrown);
      },
      success: function(data, textStatus, jqXHR) {
        var btn, chal, challengeBlock, input, _i, _len, _results;
        _results = [];
        for (_i = 0, _len = data.length; _i < _len; _i++) {
          chal = data[_i];
          btn = $('<button class="btn" type="button">Submit</button>').click(function() {
            var _this = this;
            $(this).removeClass('btn-danger').removeClass('btn-success');
            return $.ajax('/submit/challenges/' + $(this).data('item'), {
              type: 'POST',
              data: {
                key: $(this).siblings('input').val()
              },
              success: function(data) {
                if (data === '1') {
                  return $(_this).addClass('btn-success').parent().parent().addClass('solved');
                } else {
                  return $(_this).addClass('btn-danger');
                }
              }
            });
          });
          btn.data('item', chal.id);
          input = $('<input class="input-small" id="appendedInputButton" type="text" placeholder="Flag">').keydown(function(objectEvent) {
            if (objectEvent.keyCode === 13) {
              return $(this).parent().find('button').click();
            }
          });
          challengeBlock = $("					<div class=\"span3\">						<div class=\"well text-center\" id=\"well-" + chal.id + "\">					      <h3>Challenge #" + chal.id + "<br><small>" + chal.name + "</small></h3>					      <hr>					      <p>Solves: " + chal.solves + "</p>					      <a href=\"" + chal.link + "\">Download Challenge</a>					      <div class=\"input-append\">					        				        					      </div>					    </div>					</div>");
          challengeBlock.find('.input-append').append(input);
          challengeBlock.find('.input-append').append(btn);
          challengeBlock.appendTo('#challenges');
          _results.push($.ajax('/api/challenges/' + chal.id + '/users', {
            type: 'GET',
            dataType: 'json',
            success: function(data) {
              var _ref;
              if (_ref = window.user, __indexOf.call(data, _ref) >= 0) {
                return $('#well-' + this.url.split('/')[3]).addClass('solved');
              }
            }
          }));
        }
        return _results;
      }
    });
  });

}).call(this);
