// Generated by CoffeeScript 1.3.3
(function() {

  $(document).ready(function() {
    window.userSolves = {};
    window.challengeCount = 0;
    window.completeCounter = 0;
    return $.ajax('/api/challenges', {
      type: 'GET',
      dataType: 'json',
      error: function(jqXHR, textStatus, errorThrown) {
        return console.error(jqXHR, textStatus, errorThrown);
      },
      success: function(data, textStatus, jqXHR) {
        var challenge, _i, _len, _results;
        window.challengeCount = data.length;
        _results = [];
        for (_i = 0, _len = data.length; _i < _len; _i++) {
          challenge = data[_i];
          _results.push($.ajax('/api/challenges/' + challenge.id + '/users', {
            type: 'GET',
            dataType: 'json',
            error: function(jqXHR, textStatus, errorThrown) {
              return console.error(jqXHR, textStatus, errorThrown);
            },
            success: function(data) {
              var user, _j, _len1, _results1;
              _results1 = [];
              for (_j = 0, _len1 = data.length; _j < _len1; _j++) {
                user = data[_j];
                if (window.userSolves[user] != null) {
                  _results1.push(window.userSolves[user] += 1);
                } else {
                  _results1.push(window.userSolves[user] = 1);
                }
              }
              return _results1;
            },
            complete: function() {
              var n, name, names, sortedNames, _j, _len1, _results1;
              if (window.completeCounter < window.challengeCount - 1) {
                return window.completeCounter++;
              } else {
                names = (function() {
                  var _results1;
                  _results1 = [];
                  for (n in window.userSolves) {
                    _results1.push(n);
                  }
                  return _results1;
                })();
                sortedNames = names.sort(function(a, b) {
                  return window.userSolves[b] - window.userSolves[a];
                });
                _results1 = [];
                for (_j = 0, _len1 = sortedNames.length; _j < _len1; _j++) {
                  name = sortedNames[_j];
                  _results1.push($('<tr><td>' + name + '</td><td>' + window.userSolves[name] + '</td></tr>').appendTo('#scoreboard'));
                }
                return _results1;
              }
            }
          }));
        }
        return _results;
      }
    });
  });

}).call(this);
